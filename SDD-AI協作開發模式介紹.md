# SDD：規格驅動開發 - AI 協作模式

> 建立日期：2026-01-30
> 最後更新：2026-02-06

本文件介紹如何使用 **規格驅動開發 (Spec-Driven Development, SDD)** 搭配 AI 工具（如 Claude Code）進行軟體開發。

---

## 一、什麼是 SDD？

SDD 是一種將「規格文件」作為開發核心的工作流程：

```
討論需求 → 撰寫規格 → 確認規格 → 開發實作 → 規格+程式碼一起 commit
```

### 核心原則

| 原則 | 說明 |
|------|------|
| 規格是活文件 | 在討論過程中持續修改完善，不是寫完就不動 |
| 規格與程式碼同步 | 一起 commit，確保文件與實作永遠一致 |
| 規格作為知識庫 | 未來維護和需求變更時的重要參考 |

---

## 二、為什麼要用 SDD + AI？

### 傳統開發的問題

1. **上下文遺失**：AI 對話結束後，下次要從頭解釋
2. **文件與程式脫節**：文件寫完就過時
3. **知識在對話中消散**：重要的設計決策沒有留下紀錄

### SDD + AI 的好處

| 好處 | 說明 |
|------|------|
| **接續工作** | AI 讀取規格文件即可了解現況，無需重複解釋 |
| **設計決策留存** | 為什麼這樣設計、考慮過哪些方案，都有紀錄 |
| **減少溝通成本** | 新成員（人或 AI）可快速上手 |
| **版本追蹤** | 規格與程式碼一起 commit，可追溯變更歷史 |

---

## 三、工作流程

### 3.1 啟動新 Feature

```
1. 建立 feature branch
2. 建立 Feature 主文件：docs/specs/{年份}/{feature名稱}/_index.md
3. 與 AI 討論需求，AI 協助撰寫規格
4. 確認規格後開始實作
5. 規格+程式碼一起 commit
```

### 3.2 接續進行中的工作

告訴 AI：

```
請讀取 {專案路徑}/docs/specs/{年份}/{feature名稱}/_index.md，我們要接續之前的工作。
```

AI 會讀取文件，了解：
- 目前的進度
- 待辦事項
- 相關的程式檔案
- 已完成的工作

### 3.3 文件結構

```
docs/specs/
├── SDD-工作流程說明.md          # 工作流程原則（給 AI 參考）
├── _共用/                        # 跨 Feature 的共用文件（如 Git-原則.md）
├── 2026/                         # 年份目錄
│   ├── Feature-A/
│   │   ├── _index.md             # Feature 主文件
│   │   └── 階段規格2026-01-23-xxx.md  # 階段規格（含測試案例）
│   └── Feature-B/
│       └── _index.md
└── 2027/
    └── ...
```

---

## 四、在專案中設置 SDD

### 4.1 建立目錄結構

```bash
mkdir -p docs/specs/_共用
mkdir -p docs/specs/$(date +%Y)
```

### 4.2 放入工作流程說明

將 `SDD-工作流程說明.md` 放入 `docs/specs/`，並根據專案調整：
- DB Schema 文件路徑
- 專案特定的參考資源

### 4.3 建立 Git 原則文件

在 `docs/specs/_共用/` 放入 `Git-原則.md`，包含：
- 分支策略（GitFlow）
- Commit 規則
- AI 協作規則（哪些操作需要先詢問、哪些禁止）
- **Commit 前置條件**：
  1. 階段規格的測試案例必須全部勾選 ✅
  2. _index.md 需將工作狀態更新（進行中 → 已完成）

### 4.4 設定 CLAUDE.md

在專案根目錄的 `CLAUDE.md` 加入：

```markdown
## Development Workflow

This project uses **Spec-Driven Development (SDD)** for feature development:

1. **Workflow**: 討論需求 → 撰寫規格 → 確認規格 → 開發實作 → 規格+程式碼一起 commit
2. **Spec location**: `docs/specs/{年份}/{feature名稱}/`
3. **To resume work**: Read `docs/specs/{年份}/{feature名稱}/_index.md`

See `docs/specs/SDD-工作流程說明.md` for details.

## Git Rules

See `docs/specs/_共用/Git-原則.md` for details.
```

這樣 AI 在新 session 開始時就會知道專案使用 SDD 及相關的 Git 規則。

---

## 五、規格文件範本

### 5.1 Feature 主文件 (_index.md)

```markdown
# Feature: {功能名稱}

> **分支**：`feature/{branch名稱}`
> **最後更新**：{日期}

## 目標
- {這個 Feature 要達成什麼}

## 已完成的工作

### {子功能 1}
**狀態**：✅ 已完成（{日期}）

- [x] 已完成項目

## 進行中的工作

### {子功能 2}
**狀態**：🔄 進行中

- [x] 已完成項目
- [ ] 待辦項目

## 待辦功能（暫緩）

### {子功能 3}
**狀態**：⏸️ 暫緩

## 相關檔案
| 檔案 | 用途 |
|------|------|
| `path/to/file` | {說明} |

## 如何接續工作
告訴 Claude：
> 請讀取 {完整路徑}/_index.md，我們要接續之前的工作。
```

### 5.2 階段規格

**命名規則**：`階段規格YYYY-MM-DD-{主題}.md`

**何時建立**：判斷標準是「這個規格未來是否需要被獨立引用？」
- 是 → 建立階段規格
- 否 → 直接在 Feature 主文件記錄即可

```markdown
# {功能名稱}

> 建立日期：{日期}
> 狀態：草稿 / 已確認 / 已實作

## 需求背景
- 為什麼需要這個功能

## 現況分析
- 目前系統的行為
- 相關的資料表/欄位
- 相關的程式檔案

## 修改目標
- 期望達成的結果

## 技術設計
- 資料庫變更
- 程式修改範圍
- 修改方案

## 測試案例
- [ ] 測試案例 1
- [ ] 測試案例 2
（commit 前須全部勾選 ✅）

## 備註
- 其他注意事項
```

---

## 六、實際案例

以 OBTS（因公出國系統）專案的「國外出差旅費報告表」功能為例：

### 文件結構
```
docs/specs/2026/國外出差旅費報告表/
├── _index.md                                          # Feature 主文件
├── 階段規格2026-01-21-費用計算邏輯分析.md              # 分析文件
├── 階段規格2026-01-23-FinalExp匯率位數調整與總計功能.md # 規格文件
└── 階段規格2026-02-02-本案實支金額與報表調整.md        # 規格文件
```

### 工作流程
1. **討論**：與 AI 討論匯率位數不足的問題
2. **分析**：AI 協助分析現有計算邏輯，產出分析文件
3. **規格**：確定修改方案，AI 撰寫詳細規格（含測試案例）
4. **實作**：依規格修改程式碼
5. **驗證**：確認階段規格的測試案例全部勾選 ✅
6. **更新**：將 _index.md 的工作狀態從「進行中」移至「已完成」
7. **Commit**：規格文件與程式碼一起 commit

### 接續工作
下次開啟 Claude Code：
```
請讀取 {專案路徑}/docs/specs/2026/國外出差旅費報告表/_index.md，我們要接續之前的工作。
```

---

## 七、FAQ

### Q: 簡單的 bug fix 也要寫規格嗎？

不一定。判斷標準：
- **需要規格**：修改涉及多個檔案、需要設計決策、未來可能需要參考
- **不需要規格**：單純的錯字修正、明顯的 bug、一行程式碼的修改

### Q: 規格文件要寫多詳細？

以「未來的自己或同事能看懂」為標準。重點是：
- 為什麼要這樣改
- 改了哪些地方
- 如何驗證正確

### Q: Feature 跨年怎麼辦？

保持在開始開發的年份目錄，不需要移動。

### Q: 可以用其他 AI 工具嗎？

可以。SDD 的核心是「規格驅動」，不綁定特定 AI 工具。只要 AI 能讀取 markdown 文件即可。

---

## 八、快速開始

詳細的導入步驟請參考 Starter Kit 的使用說明：`E:\文件\SDD-Starter-Kit\使用說明.md`

快速清單：
- [ ] 在專案建立 `docs/specs/` 目錄
- [ ] 建立 `docs/specs/_共用/` 目錄
- [ ] 放入 `SDD-工作流程說明.md`
- [ ] 放入 `Git-原則.md`（在 `_共用/` 目錄）
- [ ] 在 `CLAUDE.md` 加入 Development Workflow 與 Git Rules 區段
- [ ] 開始第一個 Feature，建立 `_index.md`
- [ ] 與 AI 討論需求，讓 AI 協助撰寫規格（含測試案例）

---

## 九、相關資源

Starter Kit 位置：`E:\文件\SDD-Starter-Kit\`

| 檔案 | 說明 |
|------|------|
| 使用說明.md | 導入步驟與提示詞 |
| CLAUDE.md-範例片段.md | CLAUDE.md 要加入的內容 |
| docs/specs/SDD-工作流程說明.md | SDD 工作流程原則 |
| docs/specs/_共用/Git-原則.md | Git 操作規範與 AI 協作規則 |
